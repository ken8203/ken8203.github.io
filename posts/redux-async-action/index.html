<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Redux 架構下實作 Async Actions &#183; Hi im jaychung</title><link rel=stylesheet href=https://blog.jaychung.tw/css/slim.css><link rel=stylesheet href=https://blog.jaychung.tw/css/highlight.min.css><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Source+Code+Pro" rel=stylesheet type=text/css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.ico></head><body><div class=container><div class=header><h1 class=site-title><a href=https://blog.jaychung.tw/>Hi im jaychung</a></h1><p class=site-tagline></p><div class=nav><a class=nav-btn href=#><span class="ci ci-burger"></span></a><ul class=nav-list><li class=spacer>&ac;</li><li><a href=https://github.com/ken8203>Github</a></li><li><a href=https://twitter.com/jaychungtw>Twitter</a></li></ul></div></div><div class=content><div class=post><h2 class=post-title><a href=https://blog.jaychung.tw/posts/redux-async-action/>Redux 架構下實作 Async Actions</a></h2><div class=post-content><p>最近專案開發上使用了 reactjs ，並採用<code>redux</code>架構。而依照 javascript 的特性，你沒辦法假設他會將指令執行完才繼續下一道指令，所以要怎麼做到多個 Action 異步處理呢？</p><p>舉個例子，當你 update 一份資料以後，希望他能隨後就 fetch 回來，以確保 state 裡面都是最新的資料，直觀的來寫會是這樣，但眼尖的你一定會發現不太對勁。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fetchData</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createAction</span>(<span style=color:#e6db74>&#39;FETCH_DATA&#39;</span>, <span style=color:#a6e22e>APIUtil</span>.<span style=color:#a6e22e>fetchData</span>);
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>updateData</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createAction</span>(<span style=color:#e6db74>&#39;UPDATE_DATA&#39;</span>, <span style=color:#a6e22e>APIUtil</span>.<span style=color:#a6e22e>updateData</span>);
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>updateData</span>(<span style=color:#a6e22e>data</span>);
<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>fetchData</span>(); <span style=color:#75715e>// not latest result
</span></code></pre></div><p>它不會等 <code>updateData</code> 執行完才執行 <code>fetchData</code>，這樣會有順序性上的錯誤。所以我們可以在 Action 裡面動手腳，以確保<code>fetch</code>會在<code>update</code>之後。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fetchData</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createAction</span>(<span style=color:#e6db74>&#39;FETCH_DATA&#39;</span>, <span style=color:#a6e22e>APIUtil</span>.<span style=color:#a6e22e>fetchData</span>);
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>updateEventData</span>(<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>data</span>) {
  <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>dispatch</span>) =&gt; (
    <span style=color:#a6e22e>APIUtil</span>.<span style=color:#a6e22e>updateData</span>(<span style=color:#a6e22e>data</span>)
      .<span style=color:#a6e22e>then</span>(() =&gt; <span style=color:#a6e22e>dispatch</span>(<span style=color:#a6e22e>fetchData</span>()));
  );
}
</code></pre></div><p>不要用內建的<code>createAction</code>，改成自己定義 Action 就能解決這個問題囉！</p><h2 id=go-deeper>Go Deeper</h2><p><a href=http://redux.js.org/docs/advanced/AsyncActions.html>http://redux.js.org/docs/advanced/AsyncActions.html</a></p></div></div></div><div class=footer><p>Copyright © 2020. Powered by Hugo.</p></div></div><script src=https://blog.jaychung.tw/js/slim.js></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-56558534-1','auto');ga('send','pageview');</script></body></html>